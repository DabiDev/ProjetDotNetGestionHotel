@model SearchViewModel
@{
    ViewData["Title"] = "Recherche de chambres";
}

<h2><i class="fas fa-search me-2"></i>Rechercher une chambre disponible</h2>
<hr />

<form asp-action="Search" method="post" class="card p-4 mb-4">
    <div class="row g-3">
    <div class="col-md-4">
        <label asp-for="CheckIn" class="form-label"></label>
        <input asp-for="CheckIn" class="form-control" min="@DateTime.Today.ToString("yyyy-MM-dd")" />
        <span asp-validation-for="CheckIn" class="text-danger"></span>
    </div>
    <div class="col-md-4">
        <label asp-for="CheckOut" class="form-label"></label>
        <input asp-for="CheckOut" class="form-control" min="@DateTime.Today.ToString("yyyy-MM-dd")" />
        <span asp-validation-for="CheckOut" class="text-danger"></span>
    </div>
    <div class="col-md-4">
        <label class="form-label">&nbsp;</label>
        <button type="submit" class="btn btn-primary btn-lg d-block w-100">
            <i class="fas fa-search me-2"></i>Rechercher
        </button>
    </div>
    </div>
</form>

@if (Model.AvailableRooms != null && Model.AvailableRooms.Any())
{
    <h3><i class="fas fa-list me-2"></i>Chambres disponibles (@Model.AvailableRooms.Count)</h3>
    <div class="row">
        @foreach (var room in Model.AvailableRooms)
        {
            var nights = (Model.CheckOut - Model.CheckIn).Days;
            var total = room.PricePerNight * nights;
            
            <div class="col-md-4 mb-4">
                <div class="card room-card h-100">
                    <div class="card-body">
                        <div class="d-flex justify-content-between align-items-start mb-3">
                            <h5 class="card-title mb-0">
                                <i class="fas fa-bed text-primary me-2"></i>Chambre @room.Number
                            </h5>
                            <span class="badge bg-primary">@room.Type</span>
                        </div>
                        <hr />
                        <p class="card-text">
                            <i class="fas fa-users text-secondary me-2"></i>
                            <strong>Capacité:</strong> @room.Capacity personne(s)<br />
                            <i class="fas fa-tag text-secondary me-2"></i>
                            <strong>Prix/nuit:</strong> @room.PricePerNight.ToString("C")<br />
                            <i class="fas fa-moon text-secondary me-2"></i>
                            <strong>Durée:</strong> @nights nuit(s)<br />
                            <hr class="my-2" />
                            <div class="d-flex justify-content-between align-items-center">
                                <strong class="text-success">Total:</strong>
                                <span class="text-success fw-bold fs-4">@total.ToString("C")</span>
                            </div>
                        </p>
                    </div>
                    <div class="card-footer bg-transparent border-top">
                        <form asp-action="Book" method="post">
                            <input type="hidden" name="roomId" value="@room.Id" />
                            <input type="hidden" name="checkIn" value="@Model.CheckIn.ToString("yyyy-MM-dd")" />
                            <input type="hidden" name="checkOut" value="@Model.CheckOut.ToString("yyyy-MM-dd")" />
                            <button type="submit" class="btn btn-success w-100 btn-lg">
                                <i class="fas fa-calendar-check me-2"></i>Réserver maintenant
                            </button>
                        </form>
                    </div>
                </div>
            </div>
        }
    </div>
}
else if (Model.AvailableRooms != null && !Model.AvailableRooms.Any())
{
    <div class="alert alert-info text-center">
        <i class="fas fa-info-circle fa-2x mb-3 d-block"></i>
        <h5>Aucune chambre disponible</h5>
        <p class="mb-0">Aucune chambre n'est disponible pour les dates sélectionnées. Veuillez essayer d'autres dates.</p>
    </div>
}

@section Scripts {
    @{await Html.RenderPartialAsync("_ValidationScriptsPartial");}
}



